# ==========================================
# Fastify OAuth API - Development Environment
# ==========================================
# Use this template for local development
# Copy to .env and fill in your values

# ==========================================
# APPLICATION
# ==========================================
NODE_ENV=development
PORT=1337
HOST=0.0.0.0
API_VERSION=v1

# API URL (where the backend API is hosted)
# Local dev: http://localhost:1337
# Production: https://yourdomain.com
# ngrok testing: https://your-ngrok-url.ngrok-free.app
API_URL=http://localhost:1337

# Admin Panel URL (where the admin frontend is hosted)
# Local dev: http://localhost:3000
# Production: https://admin.yourdomain.com
# ngrok testing: https://your-admin-ngrok-url.ngrok-free.app
ADMIN_PANEL_URL=http://localhost:3000

# Node.js memory limit (for Raspberry Pi 4B with SSD: 512MB heap limit)
# Uncomment to enable:
# NODE_OPTIONS=--max-old-space-size=512

# ==========================================
# DOCKER CONFIGURATION
# ==========================================
# Container names (used in docker-compose.yml)
CONTAINER_POSTGRES_NAME=fastify-oauth-postgres
CONTAINER_REDIS_NAME=fastify-oauth-redis
CONTAINER_API_NAME=fastify-oauth-api
CONTAINER_CADDY_NAME=fastify-oauth-caddy

# Docker network
DOCKER_NETWORK_NAME=api-network

# Docker versions (pinned for stability)
POSTGRES_VERSION=15-alpine
REDIS_VERSION=7-alpine
NODE_VERSION=22-alpine
CADDY_VERSION=2-alpine

# Build target (development or production)
BUILD_TARGET=production

# ==========================================
# DATABASE (PostgreSQL)
# ==========================================
# For local dev: localhost (run on host) or postgres (run in Docker)
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=postgres_change_me_in_production
DATABASE_NAME=fastify_oauth_db

# SSL settings (false for local dev, true for production)
DATABASE_SSL=false

# Connection pool
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# ==========================================
# REDIS
# ==========================================
# For local dev: localhost (run on host) or redis (run in Docker)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=fastify:

# TTL settings (in seconds)
REDIS_CACHE_TTL=300
REDIS_SESSION_TTL=3600

# ==========================================
# JWT CONFIGURATION
# ==========================================
# CRITICAL: Generate a strong random secret for production!
# Use: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-key-change-me-in-production

# Token expiration
JWT_ACCESS_TOKEN_EXPIRES_IN=15m
JWT_REFRESH_TOKEN_EXPIRES_IN=7d

# Issuer and audience
JWT_ISSUER=fastify-oauth-api
JWT_AUDIENCE=fastify-oauth-api

# Algorithm (HS256, HS384, HS512, RS256, etc.)
JWT_ALGORITHM=HS256

# ==========================================
# ADMIN CONFIGURATION
# ==========================================
# Primary admin email (auto-promoted on OAuth login)
ADMIN_EMAIL=admin@example.com

# Additional admin emails (comma-separated)
# These users will be auto-promoted to admin role on login
ADMIN_EMAILS_ADDITIONAL=admin2@example.com,admin3@example.com

# Super Admin email (auto-promoted to superadmin role on first OAuth login)
# Leave empty to disable auto-promotion
SUPER_ADMIN_EMAIL=

# ==========================================
# API KEYS
# ==========================================
# Admin panel API key (used by backend for validation)
# Generate initial key with: npm run db:seed:superadmin
# CRITICAL: Store securely! Authenticates admin panel API requests.
ADMIN_PANEL_API_KEY=generate-with-npm-run-db:seed:superadmin

# NOTE: Mobile app API keys (iOS/Android) are managed through the admin panel
# and stored in the database. 1 active key per platform is allowed.
# After seeding, you'll receive:
# - ios_api_key: Store in mobile app as EXPO_PUBLIC_API_KEY
# - android_api_key: Store in mobile app as EXPO_PUBLIC_API_KEY

# ==========================================
# ADMIN PANEL (Frontend) - VITE Variables
# ==========================================
# These VITE_ prefixed variables are exposed to the frontend
# IMPORTANT: VITE_ prefix makes variables available to browser

# API URL (where the backend API is hosted)
VITE_API_URL=${API_URL}

# Admin Panel API Key (must match ADMIN_PANEL_API_KEY above)
VITE_ADMIN_PANEL_API_KEY=generate-with-npm-run-db:seed:superadmin

# ==========================================
# GOOGLE OAUTH
# ==========================================
# Get credentials from: https://console.cloud.google.com/apis/credentials

# Admin Panel OAuth (Web Application)
# Create: OAuth 2.0 Client ID → Web application
# Authorized redirect URI: ${API_URL}/api/auth/admin/google/callback
GOOGLE_CLIENT_ID_ADMIN=your-web-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET_ADMIN=your-web-client-secret
GOOGLE_REDIRECT_URI_ADMIN=${API_URL}/api/auth/admin/google/callback

# Mobile App OAuth (iOS Application)
# Create: OAuth 2.0 Client ID → iOS → Bundle ID: com.yourcompany.yourapp
GOOGLE_CLIENT_ID_IOS=your-ios-client-id.apps.googleusercontent.com
# iOS URL Scheme (reverse notation, found in Google Console iOS client)
# Format: com.googleusercontent.apps.XXXXXX-XXXXXX:/oauth2redirect/google
GOOGLE_REDIRECT_URI_IOS=com.googleusercontent.apps.your-ios-client-id:/oauth2redirect/google

# Mobile App OAuth (Android Application)
# Create: OAuth 2.0 Client ID → Android → Package name: com.yourcompany.yourapp
GOOGLE_CLIENT_ID_ANDROID=your-android-client-id.apps.googleusercontent.com
# Android URL Scheme (reverse notation, found in Google Console Android client)
GOOGLE_REDIRECT_URI_ANDROID=com.googleusercontent.apps.your-android-client-id:/oauth2redirect/google

# Scopes (space-separated)
GOOGLE_SCOPES=openid email profile

# ==========================================
# APPLE SIGN-IN
# ==========================================
# Get credentials from: https://developer.apple.com/account/resources/identifiers/list/serviceId
APPLE_CLIENT_ID=com.yourcompany.yourapp.signin
APPLE_TEAM_ID=YOUR_TEAM_ID
APPLE_KEY_ID=YOUR_KEY_ID

# Path to Apple private key (.p8 file)
APPLE_PRIVATE_KEY_PATH=./keys/apple-private-key.p8

# Admin Panel Redirect URI (web-only, admin users only)
# Uses API_URL variable defined above
# IMPORTANT: Register this URL in Apple Developer Portal Service ID configuration
APPLE_REDIRECT_URI_ADMIN=${API_URL}/api/auth/admin/apple/callback

# Mobile App Redirect URI (regular users)
# Format: myapp://oauth/callback OR https://yourdomain.com/api/auth/apple/mobile
# IMPORTANT: Register this URL in Apple Developer Portal Service ID configuration
APPLE_REDIRECT_URI_MOBILE=myapp://oauth/callback

# Scopes (space-separated)
APPLE_SCOPES=name email

# ==========================================
# CADDY REVERSE PROXY
# ==========================================
# Domain (use 'localhost' for development)
CADDY_DOMAIN=localhost

# Email for Let's Encrypt notifications
CADDY_EMAIL=admin@example.com

# ACME CA (Certificate Authority)
# Development (staging): https://acme-staging-v02.api.letsencrypt.org/directory
# Production: https://acme-v02.api.letsencrypt.org/directory
CADDY_ACME_CA=https://acme-staging-v02.api.letsencrypt.org/directory

# API backend (for reverse proxy)
API_HOST=api
API_PORT=1337

# ==========================================
# LOGGING
# ==========================================
# Log level: trace, debug, info, warn, error, fatal
LOG_LEVEL=info

# Pretty print logs (true for development, false for production)
LOG_PRETTY_PRINT=true

# ==========================================
# CORS CONFIGURATION
# ==========================================
# Allowed origins (comma-separated)
# For ngrok testing: Add your ngrok URLs here
# For production: Update to your actual domains
CORS_ORIGIN=http://localhost:3000,${API_URL}

# Allowed methods
CORS_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS

# Allow credentials
CORS_CREDENTIALS=true

# ==========================================
# RATE LIMITING
# ==========================================
# Maximum requests per time window
RATE_LIMIT_MAX=100

# Time window in milliseconds (60000 = 1 minute)
RATE_LIMIT_WINDOW=60000

# Ban duration in milliseconds (if enabled)
RATE_LIMIT_BAN=0

# ==========================================
# SESSION CONFIGURATION
# ==========================================
SESSION_SECRET=your-super-secret-session-key-change-me-in-production
SESSION_COOKIE_NAME=fastify_oauth_session
SESSION_MAX_AGE=604800000

# ==========================================
# SECURITY
# ==========================================
# Enable HTTPS redirect (only in production with Caddy)
HTTPS_REDIRECT=false

# Enable HSTS (HTTP Strict Transport Security)
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000

# ==========================================
# SWAGGER DOCUMENTATION
# ==========================================
# Enable Swagger UI
SWAGGER_ENABLED=true

# Swagger route path
SWAGGER_ROUTE=/documentation

# ==========================================
# DEVELOPMENT SETUP GUIDE
# ==========================================
# Quick Start:
# 1. Copy this file to .env: cp .env.example .env
# 2. Update OAuth credentials (Google, Apple)
# 3. Set ADMIN_EMAIL to your email address
# 4. Initialize development environment: npm run dev:init
#    - Starts PostgreSQL + Redis containers
#    - Runs migrations
#    - Seeds superadmin + API keys (copy these to VITE_ADMIN_PANEL_API_KEY)
# 5. Start development: npm run dev
# 6. Access admin panel: http://localhost:3000/admin
#
# ngrok Testing (for mobile OAuth testing):
# 1. Start ngrok: ngrok http 1337
# 2. Update API_URL to your ngrok URL
# 3. Update OAuth redirect URIs in Google/Apple consoles
# 4. Restart dev server: npm run dev
#
# For detailed setup instructions, see CLAUDE.md
