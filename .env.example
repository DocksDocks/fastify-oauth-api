# ==========================================
# Fastify OAuth API - Development Environment
# ==========================================
# Use this template for local development
# Copy to .env and fill in your values

# ==========================================
# APPLICATION
# ==========================================
NODE_ENV=development
PORT=1337
HOST=0.0.0.0
API_VERSION=v1

# API URL (where the backend API is hosted)
# Local dev: http://localhost:1337
# Production: https://yourdomain.com
# ngrok testing: https://your-ngrok-url.ngrok-free.app
API_URL=http://localhost:1337

# Admin Panel URL (where the admin frontend is hosted)
# Local dev: http://localhost:3000
# Production: https://admin.yourdomain.com
# ngrok testing: https://your-admin-ngrok-url.ngrok-free.app
ADMIN_PANEL_URL=http://localhost:3000

# Node.js memory limit (optional, adjust based on available RAM)
# Uncomment to enable:
# NODE_OPTIONS=--max-old-space-size=512

# ==========================================
# DOCKER CONFIGURATION
# ==========================================
# Container names (used in docker-compose.yml)
CONTAINER_POSTGRES_NAME=fastify-oauth-postgres
CONTAINER_REDIS_NAME=fastify-oauth-redis
CONTAINER_API_NAME=fastify-oauth-api
CONTAINER_CADDY_NAME=fastify-oauth-caddy

# Docker network
DOCKER_NETWORK_NAME=api-network

# Docker versions (pinned for stability)
POSTGRES_VERSION=15-alpine
REDIS_VERSION=7-alpine
NODE_VERSION=22-alpine
CADDY_VERSION=2-alpine

# Build target (development or production)
BUILD_TARGET=production

# ==========================================
# DATABASE (PostgreSQL)
# ==========================================
# For local dev: localhost (run on host) or postgres (run in Docker)
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=postgres_change_me_in_production
DATABASE_NAME=fastify_oauth_db

# SSL settings (false for local dev, true for production)
DATABASE_SSL=false

# Connection pool
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# ==========================================
# REDIS
# ==========================================
# For local dev: localhost (run on host) or redis (run in Docker)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=fastify:

# TTL settings (in seconds)
REDIS_CACHE_TTL=300
REDIS_SESSION_TTL=3600

# ==========================================
# JWT CONFIGURATION
# ==========================================
# CRITICAL: Generate a strong random secret for production!
# Use: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-key-change-me-in-production

# Token expiration
JWT_ACCESS_TOKEN_EXPIRES_IN=15m
JWT_REFRESH_TOKEN_EXPIRES_IN=7d

# Issuer and audience
JWT_ISSUER=fastify-oauth-api
JWT_AUDIENCE=fastify-oauth-api

# Algorithm (HS256, HS384, HS512, RS256, etc.)
JWT_ALGORITHM=HS256

# ==========================================
# ADMIN PANEL (Frontend) - Next.js Variables
# ==========================================
# These NEXT_PUBLIC_ prefixed variables are exposed to the frontend
# IMPORTANT: NEXT_PUBLIC_ prefix makes variables available to browser

# Admin Panel Port (Next.js dev server)
NEXT_PUBLIC_PORT=3000

# API URL (where the backend API is hosted)
# IMPORTANT: Next.js doesn't support variable substitution - set this directly!
# Development: http://localhost:1337
# Production: https://api.yourdomain.com
NEXT_PUBLIC_API_URL=http://localhost:1337

# ==========================================
# GOOGLE OAUTH
# ==========================================
# Get credentials from: https://console.cloud.google.com/apis/credentials

# Admin Panel OAuth (Web Application)
# Create: OAuth 2.0 Client ID → Web application
# Authorized redirect URI: ${API_URL}/api/auth/admin/google/callback
GOOGLE_CLIENT_ID_ADMIN=your-web-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET_ADMIN=your-web-client-secret
GOOGLE_REDIRECT_URI_ADMIN=${API_URL}/api/auth/admin/google/callback

# Mobile App OAuth (iOS Application)
# Create: OAuth 2.0 Client ID → iOS → Bundle ID: com.yourcompany.yourapp
GOOGLE_CLIENT_ID_IOS=your-ios-client-id.apps.googleusercontent.com
# iOS URL Scheme (reverse notation, found in Google Console iOS client)
# Format: com.googleusercontent.apps.XXXXXX-XXXXXX:/oauth2redirect/google
GOOGLE_REDIRECT_URI_IOS=com.googleusercontent.apps.your-ios-client-id:/oauth2redirect/google

# Mobile App OAuth (Android Application)
# Create: OAuth 2.0 Client ID → Android → Package name: com.yourcompany.yourapp
GOOGLE_CLIENT_ID_ANDROID=your-android-client-id.apps.googleusercontent.com
# Android URL Scheme (reverse notation, found in Google Console Android client)
GOOGLE_REDIRECT_URI_ANDROID=com.googleusercontent.apps.your-android-client-id:/oauth2redirect/google

# Scopes (space-separated)
GOOGLE_SCOPES=openid email profile

# ==========================================
# APPLE SIGN-IN
# ==========================================
# Get credentials from: https://developer.apple.com/account/resources/identifiers/list/serviceId
APPLE_CLIENT_ID=com.yourcompany.yourapp.signin
APPLE_TEAM_ID=YOUR_TEAM_ID
APPLE_KEY_ID=YOUR_KEY_ID

# Path to Apple private key (.p8 file)
APPLE_PRIVATE_KEY_PATH=./keys/apple-private-key.p8

# Admin Panel Redirect URI (web-only, admin users only)
# Uses API_URL variable defined above
# IMPORTANT: Register this URL in Apple Developer Portal Service ID configuration
APPLE_REDIRECT_URI_ADMIN=${API_URL}/api/auth/admin/apple/callback

# Mobile App Redirect URI (regular users)
# Format: myapp://oauth/callback OR https://yourdomain.com/api/auth/apple/mobile
# IMPORTANT: Register this URL in Apple Developer Portal Service ID configuration
APPLE_REDIRECT_URI_MOBILE=${API_URL}/api/auth/apple/mobile

# Scopes (space-separated)
APPLE_SCOPES=name email

# ==========================================
# INGRESSE API CONFIGURATION
# ==========================================
# Ingresse API Proxy URL (ticketing platform integration)
INGRESSE_API_PROXY_URL=https://api-proxy.backstagemirante.com

# Request timeout in milliseconds (default: 30 seconds)
INGRESSE_API_TIMEOUT=30000

# ==========================================
# ENCRYPTION (AES-256-CBC)
# ==========================================
# CRITICAL: Generate a strong 32-character key for production!
# Use: openssl rand -base64 32 | cut -c1-32
ENCRYPTION_KEY=your-32-character-encryption-key

# Initialization vector length (default: 16 bytes for AES-256-CBC)
ENCRYPTION_IV_LENGTH=16

# ==========================================
# CADDY REVERSE PROXY
# ==========================================
# Domain (use 'localhost' for development)
CADDY_DOMAIN=localhost

# Email for Let's Encrypt notifications
CADDY_EMAIL=admin@example.com

# ACME CA (Certificate Authority)
# Development (staging): https://acme-staging-v02.api.letsencrypt.org/directory
# Production: https://acme-v02.api.letsencrypt.org/directory
CADDY_ACME_CA=https://acme-staging-v02.api.letsencrypt.org/directory

# API backend (for reverse proxy)
API_HOST=api
API_PORT=1337

# ==========================================
# LOGGING
# ==========================================
# Log level: trace, debug, info, warn, error, fatal
LOG_LEVEL=info

# Pretty print logs (true for development, false for production)
LOG_PRETTY_PRINT=true

# ==========================================
# CORS CONFIGURATION
# ==========================================
# Allowed origins (comma-separated)
# For ngrok testing: Add your ngrok URLs here
# For production: Update to your actual domains
CORS_ORIGIN=${ADMIN_PANEL_URL},${API_URL}

# Allowed methods
CORS_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS

# Allow credentials
CORS_CREDENTIALS=true

# ==========================================
# RATE LIMITING
# ==========================================
# Maximum requests per time window
RATE_LIMIT_MAX=100

# Time window in milliseconds (60000 = 1 minute)
RATE_LIMIT_WINDOW=60000

# Ban duration in milliseconds (if enabled)
RATE_LIMIT_BAN=0

# ==========================================
# SESSION CONFIGURATION
# ==========================================
SESSION_SECRET=your-super-secret-session-key-change-me-in-production
SESSION_COOKIE_NAME=fastify_oauth_session
SESSION_MAX_AGE=604800000

# ==========================================
# SECURITY
# ==========================================
# Enable HTTPS redirect (only in production with Caddy)
HTTPS_REDIRECT=false

# Enable HSTS (HTTP Strict Transport Security)
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000

# ==========================================
# SWAGGER DOCUMENTATION
# ==========================================
# Enable Swagger UI
SWAGGER_ENABLED=true

# Swagger route path
SWAGGER_ROUTE=/documentation

# ==========================================
# DEVELOPMENT SETUP GUIDE
# ==========================================
# Quick Start:
# 1. Copy this file to .env: cp .env.example .env
# 2. Update OAuth credentials (Google, Apple)
# 3. Start PostgreSQL + Redis: pnpm docker:postgres && pnpm docker:redis
# 4. Run migrations: pnpm db:migrate
# 5. Start development: pnpm dev
#    - First run will trigger interactive setup wizard
#    - You'll be prompted to enter super admin email
# 6. Access admin panel: http://localhost:3000/admin
# 7. Login with your super admin email via Google/Apple OAuth
#    - You'll be auto-promoted to superadmin role
#
# Adding More Admins:
# - Login to admin panel as superadmin
# - Navigate to "Authorized Admins" page
# - Add admin emails (they'll be auto-promoted on first OAuth login)
#
# ngrok Testing (for mobile OAuth testing):
# 1. Start ngrok: ngrok http 1337
# 2. Update API_URL to your ngrok URL
# 3. Update OAuth redirect URIs in Google/Apple consoles
# 4. Restart dev server: pnpm dev
#
# For detailed setup instructions, see CLAUDE.md
